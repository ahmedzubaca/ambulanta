// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum BloodGroup {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

enum Genotype {
  AA
  AS
  SS
  AC
  SC
}

enum NotificationType {
  EMAIL
  SMS
  IN_APP
}

enum Specialization {
  GENERAL_PRACTICE
  PEDIATRICS
  CARDIOLOGY
  DERMATOLOGY  
  NEUROLOGY
  PSYCHIATRY
  DENTISTRY
  OFTALMOLOGY
  EMERGENCY_MEDICINE
}

model User {
  id             Int              @id @default(autoincrement())
  name           String
  email          String           @unique
  password       String
  profilePictureUrl      String?
  roles          Role[]         @relation("UserRoles") // Many-to-many relation with Role
  doctor        Doctor? // One-to-one relation with Doctor
  patient       Patient? // One-to-one relation with Patient
  restCode       PasswordResetCode[] // One-to-many relation with PasswordResetCode
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@map("users") // Map to "users" table
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  users       User[]   @relation("UserRoles") // Many-to-many relation with User

  @@map("roles") // Map to "roles" table
}

model PasswordResetCode {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  used      Boolean  @default(false)
  expiryDate DateTime

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  
  @@map("password_reset_codes") // Map to "password_reset_codes" table
}

model Doctor {
  id              Int              @id @default(autoincrement())
  firstName      String?
  lastName       String?  
  specialization  Specialization
  licenseNumber  String          @unique

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          Int              @unique
  appointments    Appointment[]    // One-to-many relation with Appointment

  @@map("doctors") // Map to "doctors" table
}

model Patient {
  id              Int              @id @default(autoincrement())
  firstName      String?
  lastName       String?
  dateOfBirth    DateTime?
  phoneNumber    String?
  knowenAllergies String?
  bloodGroup     BloodGroup?
  genotype       Genotype?

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          Int              @unique
  appointments    Appointment[]    // One-to-many relation with Appointment

  @@map("patients") // Map to "patients" table
}

model Appointment {
  id              Int              @id @default(autoincrement())
  startTime       DateTime
  endTime         DateTime?
  reason          String?
  meetingLink     String?
  initialSimptoms String?
  status          AppointmentStatus @default(SCHEDULED)

  doctor          Doctor           @relation(fields: [doctorId], references: [id])
  doctorId        Int

  patient         Patient          @relation(fields: [patientId], references: [id])
  patientId       Int
  consultation   Consultation? 

  @@map("appointments") // Map to "appointments" table
}

model Consultation {
  id              Int              @id @default(autoincrement())
  consultationDate DateTime         @default(now())
  subjectiveNotes String?
  objectiveFindings String?
  assessment     String?
  plan           String?

  appointment     Appointment      @relation(fields: [appointmentId], references: [id])
  appointmentId   Int              @unique

  @@map("consultations") // Map to "consultations" table
}

model Notification {
  id              Int              @id @default(autoincrement())
  subject         String
  recipient       String
  message         String
  type            NotificationType
  createdAt      DateTime         @default(now())

  @@map("notifications") // Map to "notifications" table
}
